'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.chainableGeneratorWithDefaults = undefined;var _pick2 = require('lodash/fp/pick');var _pick3 = _interopRequireDefault(_pick2);var _mapValues2 = require('lodash/fp/mapValues');var _mapValues3 = _interopRequireDefault(_mapValues2);var _compose2 = require('lodash/fp/compose');var _compose3 = _interopRequireDefault(_compose2);var _isNil2 = require('lodash/fp/isNil');var _isNil3 = _interopRequireDefault(_isNil2);var _negate3 = require('lodash/fp/negate');var _negate4 = _interopRequireDefault(_negate3);var _filter2 = require('lodash/fp/filter');var _filter3 = _interopRequireDefault(_filter2);var _partial2 = require('lodash/partial');var _partial3 = _interopRequireDefault(_partial2);var _defaults2 = require('lodash/defaults');var _defaults3 = _interopRequireDefault(_defaults2);var _keys2 = require('lodash/keys');var _keys3 = _interopRequireDefault(_keys2);var _constant2 = require('lodash/constant');var _constant3 = _interopRequireDefault(_constant2);var _isFunction2 = require('lodash/isFunction');var _isFunction3 = _interopRequireDefault(_isFunction2);var _isString2 = require('lodash/isString');var _isString3 = _interopRequireDefault(_isString2);var _negate5 = require('lodash/negate');var _negate6 = _interopRequireDefault(_negate5);var _noop2 = require('lodash/noop');var _noop3 = _interopRequireDefault(_noop2);var _identity2 = require('lodash/identity');var _identity3 = _interopRequireDefault(_identity2);var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.


















































































































































chainableGenerator = chainableGenerator;function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _objectWithoutProperties(obj, keys) {var target = {};for (var i in obj) {if (keys.indexOf(i) >= 0) continue;if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;target[i] = obj[i];}return target;}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The default options for a new chain link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * These will all be cast as functions, so that users can
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provide functional options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @type {Object}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var defaultChainlinkOptions = { prefix: null, suffix: null, sanitize: _identity3.default, separator: '.', handleLinkInvocation: _noop3.default }; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * The functional negation of _.isString
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */var isNotString = (0, _negate6.default)(_isString3.default); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Filters an array, removing `null` and `undefined`.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */var removeNilValues = (0, _filter3.default)((0, _negate4.default)(_isNil3.default)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Converts non-function values to a function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * that returns the original input value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */var maybeCastFunction = function maybeCastFunction(thing) {return (0, _isFunction3.default)(thing) ? thing : (0, _constant3.default)(thing);}; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Converts all chainlink options to functions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */var functionalizeChainlinkOptions = (0, _compose3.default)((0, _mapValues3.default)(maybeCastFunction), (0, _pick3.default)((0, _keys3.default)(defaultChainlinkOptions))); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Gets the string representation of a chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {string} This chainlink's string value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function chainlinkToString() {var prefix = this.prefix,suffix = this.suffix,sanitize = this.sanitize,separator = this.separator;var expanded = [prefix(this)].concat(_toConsumableArray(this.tokens.map(sanitize)), [suffix(this)]);return removeNilValues(expanded).join(separator(this));} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Creates a method that's called when the associated chainlink is invoked.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} properties The chainlink's property set.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {function} The chainlink's invocable base.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function handleChainlinkInvocation(properties) {return function chainlink() {var options = _extends({}, properties);this.handleLinkInvocation.call(options, options);return this;};} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * Creates a new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * @param {Object} options Chainlink creation options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * @returns {Object|function} The new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           */function makeChainlink(_ref) {var _ref$tokens = _ref.tokens,tokens = _ref$tokens === undefined ? [] : _ref$tokens,_ref$functionalChainl = _ref.functionalChainlinks,functionalChainlinks = _ref$functionalChainl === undefined ? false : _ref$functionalChainl,options = _objectWithoutProperties(_ref, ['tokens', 'functionalChainlinks']);var chainlinkOptionsWithDefaults = (0, _defaults3.default)(options, defaultChainlinkOptions); // The set of properties the chainlink will contain.
  // The "base" of the chainlink can be either an object or function
  // if `functionalChainlinks` is true, chainlinks will be functions
  // and will be callable (left up the the user to implement).
  var properties = _extends({ property: null }, chainlinkOptionsWithDefaults, functionalizeChainlinkOptions(chainlinkOptionsWithDefaults), { tokens: tokens, toString: chainlinkToString, // Intentional: to prevent node from borking out when using a function
    // as a base and attempting to util.inspect or console.log the function.
    inspect: undefined });var base = functionalChainlinks ? handleChainlinkInvocation(properties) : {};return Object.assign(base, properties);} /**
                                                                                                                                                 * Creates a new Proxy object for the given chainlink.
                                                                                                                                                 * @param {Object|function} chainlink The chainlink to create the proxy for.
                                                                                                                                                 * @param {function} makeChildlink A function to create a childlink if the
                                                                                                                                                 * desired property doesn't exist on the current chainlink.
                                                                                                                                                 * @returns
                                                                                                                                                 * @export
                                                                                                                                                 */function proxifyChainlink(chainlink, makeChildlink) {return new Proxy(chainlink, { /**
                                                                                                                                                                                                                                       * A proxy trap that will return the requested property if it exists on
                                                                                                                                                                                                                                       * the target's prototype, or return a "child chainlink" if not. Here,
                                                                                                                                                                                                                                       * we don't care about non-string properties, since we can't handle
                                                                                                                                                                                                                                       * them anyways (the user using x.y.z will always produce a string).
                                                                                                                                                                                                                                       * @param {Object} target The chainable object which is being accessed.
                                                                                                                                                                                                                                       * @param {string|Symbol} key The name of the property being accessed.
                                                                                                                                                                                                                                       * @returns {any} The actual value of target[key] or a child chainlink.
                                                                                                                                                                                                                                       */get: function get(target, key) {if (key in target || isNotString(key)) return target[key];return makeChildlink(_extends({}, chainlink, { property: key, tokens: [].concat(_toConsumableArray(chainlink.tokens), [key]) }));} });} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Generates chainables and their proxy objects.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Object} settings The settings used to create the chainable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {function} childlinkGenerator The method used to create children of this link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * This is used by `chainableGeneratorWithDefaults` to mixin default options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @returns {Proxy} The chainable's proxy object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @export
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */function chainableGenerator(settings) {var childlinkGenerator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : chainableGenerator;var options = (0, _isString3.default)(settings) ? { prefix: settings } : settings;return proxifyChainlink(makeChainlink(options), childlinkGenerator);} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Creates a function that will create chainable objects
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * @param {Object} defaults The default options for this chainable object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */var chainableGeneratorWithDefaults = exports.chainableGeneratorWithDefaults = function chainableGeneratorWithDefaults(defaults) {var childlinkGenerator = chainableGeneratorWithDefaults(defaults);return function (settings) {return chainableGenerator((0, _defaults3.default)(settings, defaults), childlinkGenerator);};}; // Creates the default chainable creation function
// that takes in options and returns a chainable proxy.
exports.default = (0, _partial3.default)(chainableGenerator, _partial3.default.placeholder, chainableGenerator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaGFpbmFibGUuanMiXSwibmFtZXMiOlsiY2hhaW5hYmxlR2VuZXJhdG9yIiwiZGVmYXVsdENoYWlubGlua09wdGlvbnMiLCJwcmVmaXgiLCJzdWZmaXgiLCJzYW5pdGl6ZSIsInNlcGFyYXRvciIsImhhbmRsZUxpbmtJbnZvY2F0aW9uIiwiaXNOb3RTdHJpbmciLCJyZW1vdmVOaWxWYWx1ZXMiLCJtYXliZUNhc3RGdW5jdGlvbiIsInRoaW5nIiwiZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMiLCJjaGFpbmxpbmtUb1N0cmluZyIsImV4cGFuZGVkIiwidG9rZW5zIiwibWFwIiwiam9pbiIsImhhbmRsZUNoYWlubGlua0ludm9jYXRpb24iLCJwcm9wZXJ0aWVzIiwiY2hhaW5saW5rIiwib3B0aW9ucyIsImNhbGwiLCJtYWtlQ2hhaW5saW5rIiwiZnVuY3Rpb25hbENoYWlubGlua3MiLCJjaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzIiwicHJvcGVydHkiLCJ0b1N0cmluZyIsImluc3BlY3QiLCJ1bmRlZmluZWQiLCJiYXNlIiwiT2JqZWN0IiwiYXNzaWduIiwicHJveGlmeUNoYWlubGluayIsIm1ha2VDaGlsZGxpbmsiLCJQcm94eSIsImdldCIsInRhcmdldCIsImtleSIsInNldHRpbmdzIiwiY2hpbGRsaW5rR2VuZXJhdG9yIiwiY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzIiwiZGVmYXVsdHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1KZ0JBLGtCLEdBQUFBLGtCLDZlQWhKaEI7Ozs7O3VoQkFNQSxJQUFNQywwQkFBMEIsRUFDOUJDLFFBQVEsSUFEc0IsRUFFOUJDLFFB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QVgsSUFBdUIsRUFBRXBDLFFBQVFvQyxRQUFWLEVBQXZCLEdBQThDQSxRQUE5RCxDQUNBLE9BQU9OLGlCQUFpQlYsY0FBY0YsT0FBZCxDQUFqQixFQUF5Q21CLGtCQUF6QyxDQUFQLENBQ0QsQyxDQUVEOzs7Z3dCQUlPLElBQU1DLDBFQUFpQyxTQUFqQ0EsOEJBQWlDLENBQUNDLFFBQUQsRUFBYyxDQUMxRCxJQUFNRixxQkFBcUJDLCtCQUErQkMsUUFBL0IsQ0FBM0IsQ0FDQSxPQUFPLDRCQUFZekMsbUJBQW1CLHdCQUFXc0MsUUFBWCxFQUFxQkcsUUFBckIsQ0FBbkIsRUFBbURGLGtCQUFuRCxDQUFaLEVBQVAsQ0FDRCxDQUhNLEMsQ0FLUDtBQUNBO2tCQUNlLHVCQUFVdkMsa0JBQVYsaUNBQWlDQSxrQkFBakMsQyIsImZpbGUiOiJjaGFpbmFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGZwIGZyb20gJ2xvZGFzaC9mcCc7XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgYSBuZXcgY2hhaW4gbGluay5cbiAqIFRoZXNlIHdpbGwgYWxsIGJlIGNhc3QgYXMgZnVuY3Rpb25zLCBzbyB0aGF0IHVzZXJzIGNhblxuICogcHJvdmlkZSBmdW5jdGlvbmFsIG9wdGlvbnMuXG4gKiBAdHlwZSB7T2JqZWN0fVxuICovXG5jb25zdCBkZWZhdWx0Q2hhaW5saW5rT3B0aW9ucyA9IHtcbiAgcHJlZml4OiBudWxsLFxuICBzdWZmaXg6IG51bGwsXG4gIHNhbml0aXplOiBfLmlkZW50aXR5LFxuICBzZXBhcmF0b3I6ICcuJyxcbiAgaGFuZGxlTGlua0ludm9jYXRpb246IF8ubm9vcCxcbn07XG5cbi8qKlxuICogVGhlIGZ1bmN0aW9uYWwgbmVnYXRpb24gb2YgXy5pc1N0cmluZ1xuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IGlzTm90U3RyaW5nID0gXy5uZWdhdGUoXy5pc1N0cmluZyk7XG5cbi8qKlxuICogRmlsdGVycyBhbiBhcnJheSwgcmVtb3ZpbmcgYG51bGxgIGFuZCBgdW5kZWZpbmVkYC5cbiAqIEBmdW5jdGlvblxuICovXG5jb25zdCByZW1vdmVOaWxWYWx1ZXMgPSBmcC5maWx0ZXIoZnAubmVnYXRlKGZwLmlzTmlsKSk7XG5cbi8qKlxuICogQ29udmVydHMgbm9uLWZ1bmN0aW9uIHZhbHVlcyB0byBhIGZ1bmN0aW9uXG4gKiB0aGF0IHJldHVybnMgdGhlIG9yaWdpbmFsIGlucHV0IHZhbHVlLlxuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IG1heWJlQ2FzdEZ1bmN0aW9uID0gdGhpbmcgPT4gKF8uaXNGdW5jdGlvbih0aGluZykgPyB0aGluZyA6IF8uY29uc3RhbnQodGhpbmcpKTtcblxuLyoqXG4gKiBDb252ZXJ0cyBhbGwgY2hhaW5saW5rIG9wdGlvbnMgdG8gZnVuY3Rpb25zLlxuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IGZ1bmN0aW9uYWxpemVDaGFpbmxpbmtPcHRpb25zID0gZnAuY29tcG9zZShcbiAgZnAubWFwVmFsdWVzKG1heWJlQ2FzdEZ1bmN0aW9uKSxcbiAgZnAucGljayhfLmtleXMoZGVmYXVsdENoYWlubGlua09wdGlvbnMpKSxcbik7XG5cbi8qKlxuICogR2V0cyB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgY2hhaW5saW5rLlxuICogQHJldHVybnMge3N0cmluZ30gVGhpcyBjaGFpbmxpbmsncyBzdHJpbmcgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIGNoYWlubGlua1RvU3RyaW5nKCkge1xuICBjb25zdCB7XG4gICAgcHJlZml4LFxuICAgIHN1ZmZpeCxcbiAgICBzYW5pdGl6ZSxcbiAgICBzZXBhcmF0b3IsXG4gIH0gPSB0aGlzO1xuXG4gIGNvbnN0IGV4cGFuZGVkID0gW3ByZWZpeCh0aGlzKSwgLi4udGhpcy50b2tlbnMubWFwKHNhbml0aXplKSwgc3VmZml4KHRoaXMpXTtcbiAgcmV0dXJuIHJlbW92ZU5pbFZhbHVlcyhleHBhbmRlZCkuam9pbihzZXBhcmF0b3IodGhpcykpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtZXRob2QgdGhhdCdzIGNhbGxlZCB3aGVuIHRoZSBhc3NvY2lhdGVkIGNoYWlubGluayBpcyBpbnZva2VkLlxuICogQHBhcmFtIHtPYmplY3R9IHByb3BlcnRpZXMgVGhlIGNoYWlubGluaydzIHByb3BlcnR5IHNldC5cbiAqIEByZXR1cm5zIHtmdW5jdGlvbn0gVGhlIGNoYWlubGluaydzIGludm9jYWJsZSBiYXNlLlxuICovXG5mdW5jdGlvbiBoYW5kbGVDaGFpbmxpbmtJbnZvY2F0aW9uKHByb3BlcnRpZXMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGNoYWlubGluaygpIHtcbiAgICBjb25zdCBvcHRpb25zID0geyAuLi5wcm9wZXJ0aWVzIH07XG4gICAgdGhpcy5oYW5kbGVMaW5rSW52b2NhdGlvbi5jYWxsKG9wdGlvbnMsIG9wdGlvbnMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgY2hhaW5saW5rLlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQ2hhaW5saW5rIGNyZWF0aW9uIG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7T2JqZWN0fGZ1bmN0aW9ufSBUaGUgbmV3IGNoYWlubGluay5cbiAqL1xuZnVuY3Rpb24gbWFrZUNoYWlubGluayh7XG4gIHRva2VucyA9IFtdLFxuICBmdW5jdGlvbmFsQ2hhaW5saW5rcyA9IGZhbHNlLFxuICAuLi5vcHRpb25zXG59KSB7XG4gIGNvbnN0IGNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMgPSBfLmRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRDaGFpbmxpbmtPcHRpb25zKTtcblxuICAvLyBUaGUgc2V0IG9mIHByb3BlcnRpZXMgdGhlIGNoYWlubGluayB3aWxsIGNvbnRhaW4uXG4gIC8vIFRoZSBcImJhc2VcIiBvZiB0aGUgY2hhaW5saW5rIGNhbiBiZSBlaXRoZXIgYW4gb2JqZWN0IG9yIGZ1bmN0aW9uXG4gIC8vIGlmIGBmdW5jdGlvbmFsQ2hhaW5saW5rc2AgaXMgdHJ1ZSwgY2hhaW5saW5rcyB3aWxsIGJlIGZ1bmN0aW9uc1xuICAvLyBhbmQgd2lsbCBiZSBjYWxsYWJsZSAobGVmdCB1cCB0aGUgdGhlIHVzZXIgdG8gaW1wbGVtZW50KS5cbiAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICBwcm9wZXJ0eTogbnVsbCxcblxuICAgIC4uLmNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMsXG4gICAgLi4uZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMoY2hhaW5saW5rT3B0aW9uc1dpdGhEZWZhdWx0cyksXG5cbiAgICB0b2tlbnMsXG4gICAgdG9TdHJpbmc6IGNoYWlubGlua1RvU3RyaW5nLFxuXG4gICAgLy8gSW50ZW50aW9uYWw6IHRvIHByZXZlbnQgbm9kZSBmcm9tIGJvcmtpbmcgb3V0IHdoZW4gdXNpbmcgYSBmdW5jdGlvblxuICAgIC8vIGFzIGEgYmFzZSBhbmQgYXR0ZW1wdGluZyB0byB1dGlsLmluc3BlY3Qgb3IgY29uc29sZS5sb2cgdGhlIGZ1bmN0aW9uLlxuICAgIGluc3BlY3Q6IHVuZGVmaW5lZCxcbiAgfTtcblxuICBjb25zdCBiYXNlID0gZnVuY3Rpb25hbENoYWlubGlua3MgPyBoYW5kbGVDaGFpbmxpbmtJbnZvY2F0aW9uKHByb3BlcnRpZXMpIDoge307XG4gIHJldHVybiBPYmplY3QuYXNzaWduKGJhc2UsIHByb3BlcnRpZXMpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgUHJveHkgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gY2hhaW5saW5rLlxuICogQHBhcmFtIHtPYmplY3R8ZnVuY3Rpb259IGNoYWlubGluayBUaGUgY2hhaW5saW5rIHRvIGNyZWF0ZSB0aGUgcHJveHkgZm9yLlxuICogQHBhcmFtIHtmdW5jdGlvbn0gbWFrZUNoaWxkbGluayBBIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGNoaWxkbGluayBpZiB0aGVcbiAqIGRlc2lyZWQgcHJvcGVydHkgZG9lc24ndCBleGlzdCBvbiB0aGUgY3VycmVudCBjaGFpbmxpbmsuXG4gKiBAcmV0dXJuc1xuICogQGV4cG9ydFxuICovXG5mdW5jdGlvbiBwcm94aWZ5Q2hhaW5saW5rKGNoYWlubGluaywgbWFrZUNoaWxkbGluaykge1xuICByZXR1cm4gbmV3IFByb3h5KGNoYWlubGluaywge1xuICAgIC8qKlxuICAgICAqIEEgcHJveHkgdHJhcCB0aGF0IHdpbGwgcmV0dXJuIHRoZSByZXF1ZXN0ZWQgcHJvcGVydHkgaWYgaXQgZXhpc3RzIG9uXG4gICAgICogdGhlIHRhcmdldCdzIHByb3RvdHlwZSwgb3IgcmV0dXJuIGEgXCJjaGlsZCBjaGFpbmxpbmtcIiBpZiBub3QuIEhlcmUsXG4gICAgICogd2UgZG9uJ3QgY2FyZSBhYm91dCBub24tc3RyaW5nIHByb3BlcnRpZXMsIHNpbmNlIHdlIGNhbid0IGhhbmRsZVxuICAgICAqIHRoZW0gYW55d2F5cyAodGhlIHVzZXIgdXNpbmcgeC55Lnogd2lsbCBhbHdheXMgcHJvZHVjZSBhIHN0cmluZykuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgY2hhaW5hYmxlIG9iamVjdCB3aGljaCBpcyBiZWluZyBhY2Nlc3NlZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xTeW1ib2x9IGtleSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgYmVpbmcgYWNjZXNzZWQuXG4gICAgICogQHJldHVybnMge2FueX0gVGhlIGFjdHVhbCB2YWx1ZSBvZiB0YXJnZXRba2V5XSBvciBhIGNoaWxkIGNoYWlubGluay5cbiAgICAgKi9cbiAgICBnZXQodGFyZ2V0LCBrZXkpIHtcbiAgICAgIGlmIChrZXkgaW4gdGFyZ2V0IHx8IGlzTm90U3RyaW5nKGtleSkpIHJldHVybiB0YXJnZXRba2V5XTtcblxuICAgICAgcmV0dXJuIG1ha2VDaGlsZGxpbmsoe1xuICAgICAgICAuLi5jaGFpbmxpbmssXG4gICAgICAgIHByb3BlcnR5OiBrZXksXG4gICAgICAgIHRva2VuczogWy4uLmNoYWlubGluay50b2tlbnMsIGtleV0sXG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgY2hhaW5hYmxlcyBhbmQgdGhlaXIgcHJveHkgb2JqZWN0cy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBUaGUgc2V0dGluZ3MgdXNlZCB0byBjcmVhdGUgdGhlIGNoYWluYWJsZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNoaWxkbGlua0dlbmVyYXRvciBUaGUgbWV0aG9kIHVzZWQgdG8gY3JlYXRlIGNoaWxkcmVuIG9mIHRoaXMgbGluay5cbiAqIFRoaXMgaXMgdXNlZCBieSBgY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzYCB0byBtaXhpbiBkZWZhdWx0IG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7UHJveHl9IFRoZSBjaGFpbmFibGUncyBwcm94eSBvYmplY3QuXG4gKiBAZXhwb3J0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGFpbmFibGVHZW5lcmF0b3Ioc2V0dGluZ3MsIGNoaWxkbGlua0dlbmVyYXRvciA9IGNoYWluYWJsZUdlbmVyYXRvcikge1xuICBjb25zdCBvcHRpb25zID0gXy5pc1N0cmluZyhzZXR0aW5ncykgPyB7IHByZWZpeDogc2V0dGluZ3MgfSA6IHNldHRpbmdzO1xuICByZXR1cm4gcHJveGlmeUNoYWlubGluayhtYWtlQ2hhaW5saW5rKG9wdGlvbnMpLCBjaGlsZGxpbmtHZW5lcmF0b3IpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgY3JlYXRlIGNoYWluYWJsZSBvYmplY3RzXG4gKiBAcGFyYW0ge09iamVjdH0gZGVmYXVsdHMgVGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgdGhpcyBjaGFpbmFibGUgb2JqZWN0LlxuICovXG5leHBvcnQgY29uc3QgY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzID0gKGRlZmF1bHRzKSA9PiB7XG4gIGNvbnN0IGNoaWxkbGlua0dlbmVyYXRvciA9IGNoYWluYWJsZUdlbmVyYXRvcldpdGhEZWZhdWx0cyhkZWZhdWx0cyk7XG4gIHJldHVybiBzZXR0aW5ncyA9PiBjaGFpbmFibGVHZW5lcmF0b3IoXy5kZWZhdWx0cyhzZXR0aW5ncywgZGVmYXVsdHMpLCBjaGlsZGxpbmtHZW5lcmF0b3IpO1xufTtcblxuLy8gQ3JlYXRlcyB0aGUgZGVmYXVsdCBjaGFpbmFibGUgY3JlYXRpb24gZnVuY3Rpb25cbi8vIHRoYXQgdGFrZXMgaW4gb3B0aW9ucyBhbmQgcmV0dXJucyBhIGNoYWluYWJsZSBwcm94eS5cbmV4cG9ydCBkZWZhdWx0IF8ucGFydGlhbChjaGFpbmFibGVHZW5lcmF0b3IsIF8sIGNoYWluYWJsZUdlbmVyYXRvcik7XG4iXX0=
