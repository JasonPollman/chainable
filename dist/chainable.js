'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.chainableGeneratorWithDefaults = undefined;var _pick2 = require('lodash/fp/pick');var _pick3 = _interopRequireDefault(_pick2);var _mapValues2 = require('lodash/fp/mapValues');var _mapValues3 = _interopRequireDefault(_mapValues2);var _compose2 = require('lodash/fp/compose');var _compose3 = _interopRequireDefault(_compose2);var _isNil2 = require('lodash/fp/isNil');var _isNil3 = _interopRequireDefault(_isNil2);var _negate3 = require('lodash/fp/negate');var _negate4 = _interopRequireDefault(_negate3);var _filter2 = require('lodash/fp/filter');var _filter3 = _interopRequireDefault(_filter2);var _partial2 = require('lodash/partial');var _partial3 = _interopRequireDefault(_partial2);var _defaults2 = require('lodash/defaults');var _defaults3 = _interopRequireDefault(_defaults2);var _keys2 = require('lodash/keys');var _keys3 = _interopRequireDefault(_keys2);var _constant2 = require('lodash/constant');var _constant3 = _interopRequireDefault(_constant2);var _isFunction2 = require('lodash/isFunction');var _isFunction3 = _interopRequireDefault(_isFunction2);var _isString2 = require('lodash/isString');var _isString3 = _interopRequireDefault(_isString2);var _negate5 = require('lodash/negate');var _negate6 = _interopRequireDefault(_negate5);var _noop2 = require('lodash/noop');var _noop3 = _interopRequireDefault(_noop2);var _identity2 = require('lodash/identity');var _identity3 = _interopRequireDefault(_identity2);var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.


















































































































































chainableGenerator = chainableGenerator;function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _objectWithoutProperties(obj, keys) {var target = {};for (var i in obj) {if (keys.indexOf(i) >= 0) continue;if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;target[i] = obj[i];}return target;}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The default options for a new chain link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * These will all be cast as functions, so that users can
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provide functional options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @type {Object}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var defaultChainlinkOptions = { prefix: null, suffix: null, sanitize: _identity3.default, separator: '.', handleLinkInvocation: _noop3.default }; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * The functional negation of _.isString
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */var isNotString = (0, _negate6.default)(_isString3.default); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Filters an array, removing `null` and `undefined`.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */var removeNilValues = (0, _filter3.default)((0, _negate4.default)(_isNil3.default)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Converts non-function values to a function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * that returns the original input value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */var maybeCastFunction = function maybeCastFunction(thing) {return (0, _isFunction3.default)(thing) ? thing : (0, _constant3.default)(thing);}; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Converts all chainlink options to functions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */var functionalizeChainlinkOptions = (0, _compose3.default)((0, _mapValues3.default)(maybeCastFunction), (0, _pick3.default)((0, _keys3.default)(defaultChainlinkOptions))); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Gets the string representation of a chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {string} This chainlink's string value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function chainlinkToString() {var prefix = this.prefix,suffix = this.suffix,sanitize = this.sanitize,separator = this.separator;var expanded = [prefix(this)].concat(_toConsumableArray(this.tokens.map(sanitize)), [suffix(this)]);return removeNilValues(expanded).join(separator(this));} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Creates a method that's called when the associated chainlink is invoked.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} properties The chainlink's property set.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {function} The chainlink's invocable base.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function handleChainlinkInvocation(properties) {return function chainlink() {var options = _extends({}, properties);this.handleLinkInvocation.call(options, options);return this;};} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * Creates a new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * @param {Object} options Chainlink creation options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           * @returns {Object|function} The new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           */function makeChainlink() {var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},_ref$tokens = _ref.tokens,tokens = _ref$tokens === undefined ? [] : _ref$tokens,_ref$functionalChainl = _ref.functionalChainlinks,functionalChainlinks = _ref$functionalChainl === undefined ? false : _ref$functionalChainl,options = _objectWithoutProperties(_ref, ['tokens', 'functionalChainlinks']);var chainlinkOptionsWithDefaults = (0, _defaults3.default)(options, defaultChainlinkOptions); // The set of properties the chainlink will contain.
  // The "base" of the chainlink can be either an object or function
  // if `functionalChainlinks` is true, chainlinks will be functions
  // and will be callable (left up the the user to implement).
  var properties = _extends({ property: null }, chainlinkOptionsWithDefaults, functionalizeChainlinkOptions(chainlinkOptionsWithDefaults), { tokens: tokens, toString: chainlinkToString, // Intentional: to prevent node from borking out when using a function
    // as a base and attempting to util.inspect or console.log the function.
    inspect: undefined });var base = functionalChainlinks ? handleChainlinkInvocation(properties) : {};return Object.assign(base, properties);} /**
                                                                                                                                                 * Creates a new Proxy object for the given chainlink.
                                                                                                                                                 * @param {Object|function} chainlink The chainlink to create the proxy for.
                                                                                                                                                 * @param {function} makeChildlink A function to create a childlink if the
                                                                                                                                                 * desired property doesn't exist on the current chainlink.
                                                                                                                                                 * @returns
                                                                                                                                                 * @export
                                                                                                                                                 */function proxifyChainlink(chainlink, makeChildlink) {return new Proxy(chainlink, { /**
                                                                                                                                                                                                                                       * A proxy trap that will return the requested property if it exists on
                                                                                                                                                                                                                                       * the target's prototype, or return a "child chainlink" if not. Here,
                                                                                                                                                                                                                                       * we don't care about non-string properties, since we can't handle
                                                                                                                                                                                                                                       * them anyways (the user using x.y.z will always produce a string).
                                                                                                                                                                                                                                       * @param {Object} target The chainable object which is being accessed.
                                                                                                                                                                                                                                       * @param {string|Symbol} key The name of the property being accessed.
                                                                                                                                                                                                                                       * @returns {any} The actual value of target[key] or a child chainlink.
                                                                                                                                                                                                                                       */get: function get(target, key) {if (key in target || isNotString(key)) return target[key];return makeChildlink(_extends({}, chainlink, { property: key, tokens: [].concat(_toConsumableArray(chainlink.tokens), [key]) }));} });} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Generates chainables and their proxy objects.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Object} settings The settings used to create the chainable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {function} childlinkGenerator The method used to create children of this link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * This is used by `chainableGeneratorWithDefaults` to mixin default options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @returns {Proxy} The chainable's proxy object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @export
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */function chainableGenerator() {var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};var childlinkGenerator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : chainableGenerator;var options = (0, _isString3.default)(settings) ? { prefix: settings } : settings;return proxifyChainlink(makeChainlink(options), childlinkGenerator);} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Creates a function that will create chainable objects
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Object} defaults The default options for this chainable object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */var chainableGeneratorWithDefaults = exports.chainableGeneratorWithDefaults = function chainableGeneratorWithDefaults() {var defaults = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};var childlinkGenerator = chainableGeneratorWithDefaults(defaults);return function (settings) {return chainableGenerator((0, _defaults3.default)(settings, defaults), childlinkGenerator);};}; // Creates the default chainable creation function
// that takes in options and returns a chainable proxy.
exports.default = (0, _partial3.default)(chainableGenerator, _partial3.default.placeholder, chainableGenerator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaGFpbmFibGUuanMiXSwibmFtZXMiOlsiY2hhaW5hYmxlR2VuZXJhdG9yIiwiZGVmYXVsdENoYWlubGlua09wdGlvbnMiLCJwcmVmaXgiLCJzdWZmaXgiLCJzYW5pdGl6ZSIsInNlcGFyYXRvciIsImhhbmRsZUxpbmtJbnZvY2F0aW9uIiwiaXNOb3RTdHJpbmciLCJyZW1vdmVOaWxWYWx1ZXMiLCJtYXliZUNhc3RGdW5jdGlvbiIsInRoaW5nIiwiZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMiLCJjaGFpbmxpbmtUb1N0cmluZyIsImV4cGFuZGVkIiwidG9rZW5zIiwibWFwIiwiam9pbiIsImhhbmRsZUNoYWlubGlua0ludm9jYXRpb24iLCJwcm9wZXJ0aWVzIiwiY2hhaW5saW5rIiwib3B0aW9ucyIsImNhbGwiLCJtYWtlQ2hhaW5saW5rIiwiZnVuY3Rpb25hbENoYWlubGlua3MiLCJjaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzIiwicHJvcGVydHkiLCJ0b1N0cmluZyIsImluc3BlY3QiLCJ1bmRlZmluZWQiLCJiYXNlIiwiT2JqZWN0IiwiYXNzaWduIiwicHJveGlmeUNoYWlubGluayIsIm1ha2VDaGlsZGxpbmsiLCJQcm94eSIsImdldCIsInRhcmdldCIsImtleSIsInNldHRpbmdzIiwiY2hpbGRsaW5rR2VuZXJhdG9yIiwiY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzIiwiZGVmYXVsdHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1KZ0JBLGtCLEdBQUFBLGtCLDZlQWhKaEI7Ozs7O3VoQkFNQSxJQUFNQywwQkFBMEIsRUFDOUJDLFFBQVEsSUFEc0IsRUFFOUJDLFFBQVEsSUFGc0IsRUFHOUJDLDRCQUg4QixFQUk5QkMsV0FBVyxHQUptQixFQUs5QkMsb0NBTDhCLEVBQWhDLEMsQ0FRQTs7OzRxQkFJQSxJQUFNQyxjQUFjLHlDQUFwQixDLENBRUE7Ozs0dUJBSUEsSUFBTUMsa0JBQWtCLHNCQUFVLHNDQUFWLENBQXhCLEMsQ0FFQTs7OztvMEJBS0EsSUFBTUMsb0JBQW9CLFNBQXBCQSxpQkFBb0IsZ0JBQVUsMEJBQWFDLEtBQWIsSUFBc0JBLEtBQXRCLEdBQThCLHdCQUFXQSxLQUFYLENBQXhDLEVBQTFCLEMsQ0FFQTs7O3M5QkFJQSxJQUFNQyxnQ0FBZ0MsdUJBQ3BDLHlCQUFhRixpQkFBYixDQURvQyxFQUVwQyxvQkFBUSxvQkFBT1IsdUJBQVAsQ0FBUixDQUZvQyxDQUF0QyxDLENBS0E7Oztxb0NBSUEsU0FBU1csaUJBQVQsR0FBNkIsS0FFekJWLE1BRnlCLEdBTXZCLElBTnVCLENBRXpCQSxNQUZ5QixDQUd6QkMsTUFIeUIsR0FNdkIsSUFOdUIsQ0FHekJBLE1BSHlCLENBSXpCQyxRQUp5QixHQU12QixJQU51QixDQUl6QkEsUUFKeUIsQ0FLekJDLFNBTHlCLEdBTXZCLElBTnVCLENBS3pCQSxTQUx5QixDQVEzQixJQUFNUSxZQUFZWCxPQUFPLElBQVAsQ0FBWiw0QkFBNkIsS0FBS1ksTUFBTCxDQUFZQyxHQUFaLENBQWdCWCxRQUFoQixDQUE3QixJQUF3REQsT0FBTyxJQUFQLENBQXhELEVBQU4sQ0FDQSxPQUFPSyxnQkFBZ0JLLFFBQWhCLEVBQTBCRyxJQUExQixDQUErQlgsVUFBVSxJQUFWLENBQS9CLENBQVAsQ0FDRCxDLENBRUQ7Ozs7cTZDQUtBLFNBQVNZLHlCQUFULENBQW1DQyxVQUFuQyxFQUErQyxDQUM3QyxPQUFPLFNBQVNDLFNBQVQsR0FBcUIsQ0FDMUIsSUFBTUMsdUJBQWVGLFVBQWYsQ0FBTixDQUNBLEtBQUtaLG9CQUFMLENBQTBCZSxJQUExQixDQUErQkQsT0FBL0IsRUFBd0NBLE9BQXhDLEVBQ0EsT0FBTyxJQUFQLENBQ0QsQ0FKRCxDQUtELEMsQ0FFRDs7Ozs2bERBS0EsU0FBU0UsYUFBVCxHQUlRLGdGQUFKLEVBQUksb0JBSE5SLE1BR00sQ0FITkEsTUFHTSwrQkFIRyxFQUdILDRDQUZOUyxvQkFFTSxDQUZOQSxvQkFFTSx5Q0FGaUIsS0FFakIseUJBREhILE9BQ0csc0VBQ04sSUFBTUksK0JBQStCLHdCQUFXSixPQUFYLEVBQW9CbkIsdUJBQXBCLENBQXJDLENBRE0sQ0FHTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1pQix3QkFDSk8sVUFBVSxJQUROLElBR0RELDRCQUhDLEVBSURiLDhCQUE4QmEsNEJBQTlCLENBSkMsSUFNSlYsY0FOSSxFQU9KWSxVQUFVZCxpQkFQTixFQVNKO0FBQ0E7QUFDQWUsYUFBU0MsU0FYTCxHQUFOLENBY0EsSUFBTUMsT0FBT04sdUJBQXVCTiwwQkFBMEJDLFVBQTFCLENBQXZCLEdBQStELEVBQTVFLENBQ0EsT0FBT1ksT0FBT0MsTUFBUCxDQUFjRixJQUFkLEVBQW9CWCxVQUFwQixDQUFQLENBQ0QsQyxDQUVEOzs7Ozs7O21KQVFBLFNBQVNjLGdCQUFULENBQTBCYixTQUExQixFQUFxQ2MsYUFBckMsRUFBb0QsQ0FDbEQsT0FBTyxJQUFJQyxLQUFKLENBQVVmLFNBQVYsRUFBcUIsRUFDMUI7Ozs7Ozs7O3lPQVNBZ0IsR0FWMEIsZUFVdEJDLE1BVnNCLEVBVWRDLEdBVmMsRUFVVCxDQUNmLElBQUlBLE9BQU9ELE1BQVAsSUFBaUI3QixZQUFZOEIsR0FBWixDQUFyQixFQUF1QyxPQUFPRCxPQUFPQyxHQUFQLENBQVAsQ0FFdkMsT0FBT0osMkJBQ0ZkLFNBREUsSUFFTE0sVUFBVVksR0FGTCxFQUdMdkIscUNBQVlLLFVBQVVMLE1BQXRCLElBQThCdUIsR0FBOUIsRUFISyxJQUFQLENBS0QsQ0FsQnlCLEVBQXJCLENBQVAsQ0FvQkQsQyxDQUVEOzs7Ozs7OzhjQVFPLFNBQVNyQyxrQkFBVCxHQUFvRixLQUF4RHNDLFFBQXdELHVFQUE3QyxFQUE2QyxLQUF6Q0Msa0JBQXlDLHVFQUFwQnZDLGtCQUFvQixDQUN6RixJQUFNb0IsVUFBVSx3QkFBV2tCLFFBQVgsSUFBdUIsRUFBRXBDLFFBQVFvQyxRQUFWLEVBQXZCLEdBQThDQSxRQUE5RCxDQUNBLE9BQU9OLGlCQUFpQlYsY0FBY0YsT0FBZCxDQUFqQixFQUF5Q21CLGtCQUF6QyxDQUFQLENBQ0QsQyxDQUVEOzs7ODBCQUlPLElBQU1DLDBFQUFpQyxTQUFqQ0EsOEJBQWlDLEdBQW1CLEtBQWxCQyxRQUFrQix1RUFBUCxFQUFPLENBQy9ELElBQU1GLHFCQUFxQkMsK0JBQStCQyxRQUEvQixDQUEzQixDQUNBLE9BQU8sNEJBQVl6QyxtQkFBbUIsd0JBQVdzQyxRQUFYLEVBQXFCRyxRQUFyQixDQUFuQixFQUFtREYsa0JBQW5ELENBQVosRUFBUCxDQUNELENBSE0sQyxDQUtQO0FBQ0E7a0JBQ2UsdUJBQVV2QyxrQkFBVixpQ0FBaUNBLGtCQUFqQyxDIiwiZmlsZSI6ImNoYWluYWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgZnAgZnJvbSAnbG9kYXNoL2ZwJztcblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBvcHRpb25zIGZvciBhIG5ldyBjaGFpbiBsaW5rLlxuICogVGhlc2Ugd2lsbCBhbGwgYmUgY2FzdCBhcyBmdW5jdGlvbnMsIHNvIHRoYXQgdXNlcnMgY2FuXG4gKiBwcm92aWRlIGZ1bmN0aW9uYWwgb3B0aW9ucy5cbiAqIEB0eXBlIHtPYmplY3R9XG4gKi9cbmNvbnN0IGRlZmF1bHRDaGFpbmxpbmtPcHRpb25zID0ge1xuICBwcmVmaXg6IG51bGwsXG4gIHN1ZmZpeDogbnVsbCxcbiAgc2FuaXRpemU6IF8uaWRlbnRpdHksXG4gIHNlcGFyYXRvcjogJy4nLFxuICBoYW5kbGVMaW5rSW52b2NhdGlvbjogXy5ub29wLFxufTtcblxuLyoqXG4gKiBUaGUgZnVuY3Rpb25hbCBuZWdhdGlvbiBvZiBfLmlzU3RyaW5nXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgaXNOb3RTdHJpbmcgPSBfLm5lZ2F0ZShfLmlzU3RyaW5nKTtcblxuLyoqXG4gKiBGaWx0ZXJzIGFuIGFycmF5LCByZW1vdmluZyBgbnVsbGAgYW5kIGB1bmRlZmluZWRgLlxuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IHJlbW92ZU5pbFZhbHVlcyA9IGZwLmZpbHRlcihmcC5uZWdhdGUoZnAuaXNOaWwpKTtcblxuLyoqXG4gKiBDb252ZXJ0cyBub24tZnVuY3Rpb24gdmFsdWVzIHRvIGEgZnVuY3Rpb25cbiAqIHRoYXQgcmV0dXJucyB0aGUgb3JpZ2luYWwgaW5wdXQgdmFsdWUuXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgbWF5YmVDYXN0RnVuY3Rpb24gPSB0aGluZyA9PiAoXy5pc0Z1bmN0aW9uKHRoaW5nKSA/IHRoaW5nIDogXy5jb25zdGFudCh0aGluZykpO1xuXG4vKipcbiAqIENvbnZlcnRzIGFsbCBjaGFpbmxpbmsgb3B0aW9ucyB0byBmdW5jdGlvbnMuXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMgPSBmcC5jb21wb3NlKFxuICBmcC5tYXBWYWx1ZXMobWF5YmVDYXN0RnVuY3Rpb24pLFxuICBmcC5waWNrKF8ua2V5cyhkZWZhdWx0Q2hhaW5saW5rT3B0aW9ucykpLFxuKTtcblxuLyoqXG4gKiBHZXRzIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBjaGFpbmxpbmsuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGlzIGNoYWlubGluaydzIHN0cmluZyB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gY2hhaW5saW5rVG9TdHJpbmcoKSB7XG4gIGNvbnN0IHtcbiAgICBwcmVmaXgsXG4gICAgc3VmZml4LFxuICAgIHNhbml0aXplLFxuICAgIHNlcGFyYXRvcixcbiAgfSA9IHRoaXM7XG5cbiAgY29uc3QgZXhwYW5kZWQgPSBbcHJlZml4KHRoaXMpLCAuLi50aGlzLnRva2Vucy5tYXAoc2FuaXRpemUpLCBzdWZmaXgodGhpcyldO1xuICByZXR1cm4gcmVtb3ZlTmlsVmFsdWVzKGV4cGFuZGVkKS5qb2luKHNlcGFyYXRvcih0aGlzKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1ldGhvZCB0aGF0J3MgY2FsbGVkIHdoZW4gdGhlIGFzc29jaWF0ZWQgY2hhaW5saW5rIGlzIGludm9rZWQuXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBUaGUgY2hhaW5saW5rJ3MgcHJvcGVydHkgc2V0LlxuICogQHJldHVybnMge2Z1bmN0aW9ufSBUaGUgY2hhaW5saW5rJ3MgaW52b2NhYmxlIGJhc2UuXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZUNoYWlubGlua0ludm9jYXRpb24ocHJvcGVydGllcykge1xuICByZXR1cm4gZnVuY3Rpb24gY2hhaW5saW5rKCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLnByb3BlcnRpZXMgfTtcbiAgICB0aGlzLmhhbmRsZUxpbmtJbnZvY2F0aW9uLmNhbGwob3B0aW9ucywgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBjaGFpbmxpbmsuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBDaGFpbmxpbmsgY3JlYXRpb24gb3B0aW9ucy5cbiAqIEByZXR1cm5zIHtPYmplY3R8ZnVuY3Rpb259IFRoZSBuZXcgY2hhaW5saW5rLlxuICovXG5mdW5jdGlvbiBtYWtlQ2hhaW5saW5rKHtcbiAgdG9rZW5zID0gW10sXG4gIGZ1bmN0aW9uYWxDaGFpbmxpbmtzID0gZmFsc2UsXG4gIC4uLm9wdGlvbnNcbn0gPSB7fSkge1xuICBjb25zdCBjaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzID0gXy5kZWZhdWx0cyhvcHRpb25zLCBkZWZhdWx0Q2hhaW5saW5rT3B0aW9ucyk7XG5cbiAgLy8gVGhlIHNldCBvZiBwcm9wZXJ0aWVzIHRoZSBjaGFpbmxpbmsgd2lsbCBjb250YWluLlxuICAvLyBUaGUgXCJiYXNlXCIgb2YgdGhlIGNoYWlubGluayBjYW4gYmUgZWl0aGVyIGFuIG9iamVjdCBvciBmdW5jdGlvblxuICAvLyBpZiBgZnVuY3Rpb25hbENoYWlubGlua3NgIGlzIHRydWUsIGNoYWlubGlua3Mgd2lsbCBiZSBmdW5jdGlvbnNcbiAgLy8gYW5kIHdpbGwgYmUgY2FsbGFibGUgKGxlZnQgdXAgdGhlIHRoZSB1c2VyIHRvIGltcGxlbWVudCkuXG4gIGNvbnN0IHByb3BlcnRpZXMgPSB7XG4gICAgcHJvcGVydHk6IG51bGwsXG5cbiAgICAuLi5jaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzLFxuICAgIC4uLmZ1bmN0aW9uYWxpemVDaGFpbmxpbmtPcHRpb25zKGNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMpLFxuXG4gICAgdG9rZW5zLFxuICAgIHRvU3RyaW5nOiBjaGFpbmxpbmtUb1N0cmluZyxcblxuICAgIC8vIEludGVudGlvbmFsOiB0byBwcmV2ZW50IG5vZGUgZnJvbSBib3JraW5nIG91dCB3aGVuIHVzaW5nIGEgZnVuY3Rpb25cbiAgICAvLyBhcyBhIGJhc2UgYW5kIGF0dGVtcHRpbmcgdG8gdXRpbC5pbnNwZWN0IG9yIGNvbnNvbGUubG9nIHRoZSBmdW5jdGlvbi5cbiAgICBpbnNwZWN0OiB1bmRlZmluZWQsXG4gIH07XG5cbiAgY29uc3QgYmFzZSA9IGZ1bmN0aW9uYWxDaGFpbmxpbmtzID8gaGFuZGxlQ2hhaW5saW5rSW52b2NhdGlvbihwcm9wZXJ0aWVzKSA6IHt9O1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihiYXNlLCBwcm9wZXJ0aWVzKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IFByb3h5IG9iamVjdCBmb3IgdGhlIGdpdmVuIGNoYWlubGluay5cbiAqIEBwYXJhbSB7T2JqZWN0fGZ1bmN0aW9ufSBjaGFpbmxpbmsgVGhlIGNoYWlubGluayB0byBjcmVhdGUgdGhlIHByb3h5IGZvci5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IG1ha2VDaGlsZGxpbmsgQSBmdW5jdGlvbiB0byBjcmVhdGUgYSBjaGlsZGxpbmsgaWYgdGhlXG4gKiBkZXNpcmVkIHByb3BlcnR5IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIGN1cnJlbnQgY2hhaW5saW5rLlxuICogQHJldHVybnNcbiAqIEBleHBvcnRcbiAqL1xuZnVuY3Rpb24gcHJveGlmeUNoYWlubGluayhjaGFpbmxpbmssIG1ha2VDaGlsZGxpbmspIHtcbiAgcmV0dXJuIG5ldyBQcm94eShjaGFpbmxpbmssIHtcbiAgICAvKipcbiAgICAgKiBBIHByb3h5IHRyYXAgdGhhdCB3aWxsIHJldHVybiB0aGUgcmVxdWVzdGVkIHByb3BlcnR5IGlmIGl0IGV4aXN0cyBvblxuICAgICAqIHRoZSB0YXJnZXQncyBwcm90b3R5cGUsIG9yIHJldHVybiBhIFwiY2hpbGQgY2hhaW5saW5rXCIgaWYgbm90LiBIZXJlLFxuICAgICAqIHdlIGRvbid0IGNhcmUgYWJvdXQgbm9uLXN0cmluZyBwcm9wZXJ0aWVzLCBzaW5jZSB3ZSBjYW4ndCBoYW5kbGVcbiAgICAgKiB0aGVtIGFueXdheXMgKHRoZSB1c2VyIHVzaW5nIHgueS56IHdpbGwgYWx3YXlzIHByb2R1Y2UgYSBzdHJpbmcpLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGhlIGNoYWluYWJsZSBvYmplY3Qgd2hpY2ggaXMgYmVpbmcgYWNjZXNzZWQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd8U3ltYm9sfSBrZXkgVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IGJlaW5nIGFjY2Vzc2VkLlxuICAgICAqIEByZXR1cm5zIHthbnl9IFRoZSBhY3R1YWwgdmFsdWUgb2YgdGFyZ2V0W2tleV0gb3IgYSBjaGlsZCBjaGFpbmxpbmsuXG4gICAgICovXG4gICAgZ2V0KHRhcmdldCwga2V5KSB7XG4gICAgICBpZiAoa2V5IGluIHRhcmdldCB8fCBpc05vdFN0cmluZyhrZXkpKSByZXR1cm4gdGFyZ2V0W2tleV07XG5cbiAgICAgIHJldHVybiBtYWtlQ2hpbGRsaW5rKHtcbiAgICAgICAgLi4uY2hhaW5saW5rLFxuICAgICAgICBwcm9wZXJ0eToga2V5LFxuICAgICAgICB0b2tlbnM6IFsuLi5jaGFpbmxpbmsudG9rZW5zLCBrZXldLFxuICAgICAgfSk7XG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGNoYWluYWJsZXMgYW5kIHRoZWlyIHByb3h5IG9iamVjdHMuXG4gKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgVGhlIHNldHRpbmdzIHVzZWQgdG8gY3JlYXRlIHRoZSBjaGFpbmFibGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjaGlsZGxpbmtHZW5lcmF0b3IgVGhlIG1ldGhvZCB1c2VkIHRvIGNyZWF0ZSBjaGlsZHJlbiBvZiB0aGlzIGxpbmsuXG4gKiBUaGlzIGlzIHVzZWQgYnkgYGNoYWluYWJsZUdlbmVyYXRvcldpdGhEZWZhdWx0c2AgdG8gbWl4aW4gZGVmYXVsdCBvcHRpb25zLlxuICogQHJldHVybnMge1Byb3h5fSBUaGUgY2hhaW5hYmxlJ3MgcHJveHkgb2JqZWN0LlxuICogQGV4cG9ydFxuICovXG5leHBvcnQgZnVuY3Rpb24gY2hhaW5hYmxlR2VuZXJhdG9yKHNldHRpbmdzID0ge30sIGNoaWxkbGlua0dlbmVyYXRvciA9IGNoYWluYWJsZUdlbmVyYXRvcikge1xuICBjb25zdCBvcHRpb25zID0gXy5pc1N0cmluZyhzZXR0aW5ncykgPyB7IHByZWZpeDogc2V0dGluZ3MgfSA6IHNldHRpbmdzO1xuICByZXR1cm4gcHJveGlmeUNoYWlubGluayhtYWtlQ2hhaW5saW5rKG9wdGlvbnMpLCBjaGlsZGxpbmtHZW5lcmF0b3IpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgY3JlYXRlIGNoYWluYWJsZSBvYmplY3RzXG4gKiBAcGFyYW0ge09iamVjdH0gZGVmYXVsdHMgVGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgdGhpcyBjaGFpbmFibGUgb2JqZWN0LlxuICovXG5leHBvcnQgY29uc3QgY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzID0gKGRlZmF1bHRzID0ge30pID0+IHtcbiAgY29uc3QgY2hpbGRsaW5rR2VuZXJhdG9yID0gY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzKGRlZmF1bHRzKTtcbiAgcmV0dXJuIHNldHRpbmdzID0+IGNoYWluYWJsZUdlbmVyYXRvcihfLmRlZmF1bHRzKHNldHRpbmdzLCBkZWZhdWx0cyksIGNoaWxkbGlua0dlbmVyYXRvcik7XG59O1xuXG4vLyBDcmVhdGVzIHRoZSBkZWZhdWx0IGNoYWluYWJsZSBjcmVhdGlvbiBmdW5jdGlvblxuLy8gdGhhdCB0YWtlcyBpbiBvcHRpb25zIGFuZCByZXR1cm5zIGEgY2hhaW5hYmxlIHByb3h5LlxuZXhwb3J0IGRlZmF1bHQgXy5wYXJ0aWFsKGNoYWluYWJsZUdlbmVyYXRvciwgXywgY2hhaW5hYmxlR2VuZXJhdG9yKTtcbiJdfQ==
