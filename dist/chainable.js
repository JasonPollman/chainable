'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _pick2 = require('lodash/fp/pick');var _pick3 = _interopRequireDefault(_pick2);var _mapValues2 = require('lodash/fp/mapValues');var _mapValues3 = _interopRequireDefault(_mapValues2);var _compose2 = require('lodash/fp/compose');var _compose3 = _interopRequireDefault(_compose2);var _isNil2 = require('lodash/fp/isNil');var _isNil3 = _interopRequireDefault(_isNil2);var _negate3 = require('lodash/fp/negate');var _negate4 = _interopRequireDefault(_negate3);var _filter2 = require('lodash/fp/filter');var _filter3 = _interopRequireDefault(_filter2);var _defaults2 = require('lodash/defaults');var _defaults3 = _interopRequireDefault(_defaults2);var _keys2 = require('lodash/keys');var _keys3 = _interopRequireDefault(_keys2);var _constant2 = require('lodash/constant');var _constant3 = _interopRequireDefault(_constant2);var _isFunction2 = require('lodash/isFunction');var _isFunction3 = _interopRequireDefault(_isFunction2);var _isString2 = require('lodash/isString');var _isString3 = _interopRequireDefault(_isString2);var _negate5 = require('lodash/negate');var _negate6 = _interopRequireDefault(_negate5);var _noop2 = require('lodash/noop');var _noop3 = _interopRequireDefault(_noop2);var _identity2 = require('lodash/identity');var _identity3 = _interopRequireDefault(_identity2);var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.default =







































































































































chainableGenerator;exports.










chainableGeneratorWithDefaults = chainableGeneratorWithDefaults;function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _objectWithoutProperties(obj, keys) {var target = {};for (var i in obj) {if (keys.indexOf(i) >= 0) continue;if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;target[i] = obj[i];}return target;}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * The default options for a new chain link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * These will all be cast as functions so that users
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * can provide functional options if desired.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * @type {Object}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */var defaultChainlinkOptions = { prefix: null, suffix: null, sanitize: _identity3.default, separator: '.', sanitizeLinks: _identity3.default, handleLinkInvocation: _noop3.default }; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The functional negation of _.isString
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var isNotString = (0, _negate6.default)(_isString3.default); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Filters an array by removing all occurrences of `null` and `undefined`.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var removeNilValues = (0, _filter3.default)((0, _negate4.default)(_isNil3.default)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Converts non-function values to a function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */var maybeCastFunction = function maybeCastFunction(thing) {return (0, _isFunction3.default)(thing) ? thing : (0, _constant3.default)(thing);}; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Converts all chainlink options to functions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */var functionalizeChainlinkOptions = (0, _compose3.default)((0, _mapValues3.default)(maybeCastFunction), (0, _pick3.default)((0, _keys3.default)(defaultChainlinkOptions))); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Creates a function that gets the string representation of a chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * @returns {string} This chainlink's string value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */function chainlinkToString(properties) {return function () {var tokens = properties.tokens,prefix = properties.prefix,suffix = properties.suffix,sanitize = properties.sanitize,separator = properties.separator,sanitizeLinks = properties.sanitizeLinks;var expanded = [prefix(properties)].concat(_toConsumableArray(tokens.map(sanitizeLinks)), [suffix(properties)]);return sanitize(removeNilValues(expanded).join(separator(properties)));};} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Creates a new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @param {Object} options Chainlink creation options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @param {function} makeChildlink A function to create a childlinks.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @returns {Object|function} The new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */function makeChainlink(_ref, makeChildlink) {var _ref$tokens = _ref.tokens,tokens = _ref$tokens === undefined ? [] : _ref$tokens,options = _objectWithoutProperties(_ref, ['tokens']);var chainlinkOptionsWithDefaults = (0, _defaults3.default)(options, defaultChainlinkOptions);var properties = _extends({ property: null }, chainlinkOptionsWithDefaults, functionalizeChainlinkOptions(chainlinkOptionsWithDefaults), { // Intentional: to prevent node from borking out when using a function
    // as a base and attempting to util.inspect or console.log the function.
    inspect: undefined, tokens: tokens });Object.assign(properties, { toString: chainlinkToString(_extends({}, properties)) }); // The "base" of the chainlink can be either an object or function
  // if `functionalChainlinks` is true, chainlinks will be functions
  // and will be callable (left up the the user to implement).
  var base = !options.invocableLinks ? {} : function chainlink() {for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}properties.handleLinkInvocation.apply(properties, [_extends({}, properties)].concat(args));return makeChildlink(base);};return Object.assign(base, properties);} /**
                                                                                                                                                                                                                                                                                                                                                        * Creates a new Proxy object for the given chainlink.
                                                                                                                                                                                                                                                                                                                                                        * @param {Object|function} chainlink The chainlink to create the proxy for.
                                                                                                                                                                                                                                                                                                                                                        * @param {function} makeChildlink A function to create a childlink if the
                                                                                                                                                                                                                                                                                                                                                        * desired property doesn't exist on the current chainlink.
                                                                                                                                                                                                                                                                                                                                                        * @returns
                                                                                                                                                                                                                                                                                                                                                        * @export
                                                                                                                                                                                                                                                                                                                                                        */function proxifyChainlink(chainlink, makeChildlink) {return new Proxy(chainlink, { /**
                                                                                                                                                                                                                                                                                                                                                                                                                                              * A proxy trap that will return the requested property if it exists on
                                                                                                                                                                                                                                                                                                                                                                                                                                              * the target's prototype, or return a "child chainlink" if not. Here,
                                                                                                                                                                                                                                                                                                                                                                                                                                              * we don't care about non-string properties, since we can't handle
                                                                                                                                                                                                                                                                                                                                                                                                                                              * them anyways (the user using x.y.z will always produce a string).
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @param {Object} target The chainable object which is being accessed.
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @param {string|Symbol} key The name of the property being accessed.
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @returns {any} The actual value of target[key] or a child chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                              */get: function get(target, key) {if (key in target || isNotString(key)) return target[key];return makeChildlink(_extends({}, chainlink, { property: key, tokens: [].concat(_toConsumableArray(chainlink.tokens), [key]) }));} });} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Generates chainables and their proxy objects.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} settings The settings used to create the chainable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {function} childlinkGenerator The method used to create children of this link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * This is used by `chainableGeneratorWithDefaults` to mixin default options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {Proxy} The chainable's proxy object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @export
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function chainableGenerator() {var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};var options = (0, _isString3.default)(settings) ? { prefix: settings } : settings;return proxifyChainlink(makeChainlink(options, chainableGenerator), chainableGenerator);} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Creates a function that will create chainable objects
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @param {Object} defaults The default options for this chainable object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @returns {function} A function that will create new chainable objects, with
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * the supplied defaults mixed in with the options provided to the function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */function chainableGeneratorWithDefaults() {var defaults = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};return function (settings) {return chainableGenerator((0, _defaults3.default)({}, settings, defaults));};}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaGFpbmFibGUuanMiXSwibmFtZXMiOlsiY2hhaW5hYmxlR2VuZXJhdG9yIiwiY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzIiwiZGVmYXVsdENoYWlubGlua09wdGlvbnMiLCJwcmVmaXgiLCJzdWZmaXgiLCJzYW5pdGl6ZSIsInNlcGFyYXRvciIsInNhbml0aXplTGlua3MiLCJoYW5kbGVMaW5rSW52b2NhdGlvbiIsImlzTm90U3RyaW5nIiwicmVtb3ZlTmlsVmFsdWVzIiwibWF5YmVDYXN0RnVuY3Rpb24iLCJ0aGluZyIsImZ1bmN0aW9uYWxpemVDaGFpbmxpbmtPcHRpb25zIiwiY2hhaW5saW5rVG9TdHJpbmciLCJwcm9wZXJ0aWVzIiwidG9rZW5zIiwiZXhwYW5kZWQiLCJtYXAiLCJqb2luIiwibWFrZUNoYWlubGluayIsIm1ha2VDaGlsZGxpbmsiLCJvcHRpb25zIiwiY2hhaW5saW5rT3B0aW9uc1dpdGhEZWZhdWx0cyIsInByb3BlcnR5IiwiaW5zcGVjdCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImFzc2lnbiIsInRvU3RyaW5nIiwiYmFzZSIsImludm9jYWJsZUxpbmtzIiwiY2hhaW5saW5rIiwiYXJncyIsInByb3hpZnlDaGFpbmxpbmsiLCJQcm94eSIsImdldCIsInRhcmdldCIsImtleSIsInNldHRpbmdzIiwiZGVmYXVsdHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3SXdCQSxrQjs7Ozs7Ozs7Ozs7QUFXUkMsOEIsR0FBQUEsOEIsNmVBaEpoQjs7Ozs7K2lCQU1BLElBQU1DLDBCQUEwQixFQUM5QkMsUUFBUSxJQURzQixFQUU5QkMsUUFBUSxJQUZzQixFQUc5QkMsNEJBSDhCLEVBSTlCQyxX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VUFBVSx3QkFBV2lCLFFBQVgsSUFBdUIsRUFBRXBDLFFBQVFvQyxRQUFWLEVBQXZCLEdBQThDQSxRQUE5RCxDQUNBLE9BQU9MLGlCQUFpQmQsY0FBY0UsT0FBZCxFQUF1QnRCLGtCQUF2QixDQUFqQixFQUE2REEsa0JBQTdELENBQVAsQ0FDRCxDLENBRUQ7Ozs7O3k3QkFNTyxTQUFTQyw4QkFBVCxHQUF1RCxLQUFmdUMsUUFBZSx1RUFBSixFQUFJLENBQzVELE9BQU8sNEJBQVl4QyxtQkFBbUIsd0JBQVcsRUFBWCxFQUFldUMsUUFBZixFQUF5QkMsUUFBekIsQ0FBbkIsQ0FBWixFQUFQLENBQ0QiLCJmaWxlIjoiY2hhaW5hYmxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBmcCBmcm9tICdsb2Rhc2gvZnAnO1xuXG4vKipcbiAqIFRoZSBkZWZhdWx0IG9wdGlvbnMgZm9yIGEgbmV3IGNoYWluIGxpbmsuXG4gKiBUaGVzZSB3aWxsIGFsbCBiZSBjYXN0IGFzIGZ1bmN0aW9ucyBzbyB0aGF0IHVzZXJzXG4gKiBjYW4gcHJvdmlkZSBmdW5jdGlvbmFsIG9wdGlvbnMgaWYgZGVzaXJlZC5cbiAqIEB0eXBlIHtPYmplY3R9XG4gKi9cbmNvbnN0IGRlZmF1bHRDaGFpbmxpbmtPcHRpb25zID0ge1xuICBwcmVmaXg6IG51bGwsXG4gIHN1ZmZpeDogbnVsbCxcbiAgc2FuaXRpemU6IF8uaWRlbnRpdHksXG4gIHNlcGFyYXRvcjogJy4nLFxuICBzYW5pdGl6ZUxpbmtzOiBfLmlkZW50aXR5LFxuICBoYW5kbGVMaW5rSW52b2NhdGlvbjogXy5ub29wLFxufTtcblxuLyoqXG4gKiBUaGUgZnVuY3Rpb25hbCBuZWdhdGlvbiBvZiBfLmlzU3RyaW5nXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgaXNOb3RTdHJpbmcgPSBfLm5lZ2F0ZShfLmlzU3RyaW5nKTtcblxuLyoqXG4gKiBGaWx0ZXJzIGFuIGFycmF5IGJ5IHJlbW92aW5nIGFsbCBvY2N1cnJlbmNlcyBvZiBgbnVsbGAgYW5kIGB1bmRlZmluZWRgLlxuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IHJlbW92ZU5pbFZhbHVlcyA9IGZwLmZpbHRlcihmcC5uZWdhdGUoZnAuaXNOaWwpKTtcblxuLyoqXG4gKiBDb252ZXJ0cyBub24tZnVuY3Rpb24gdmFsdWVzIHRvIGEgZnVuY3Rpb24uXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgbWF5YmVDYXN0RnVuY3Rpb24gPSB0aGluZyA9PiAoXy5pc0Z1bmN0aW9uKHRoaW5nKSA/IHRoaW5nIDogXy5jb25zdGFudCh0aGluZykpO1xuXG4vKipcbiAqIENvbnZlcnRzIGFsbCBjaGFpbmxpbmsgb3B0aW9ucyB0byBmdW5jdGlvbnMuXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMgPSBmcC5jb21wb3NlKFxuICBmcC5tYXBWYWx1ZXMobWF5YmVDYXN0RnVuY3Rpb24pLFxuICBmcC5waWNrKF8ua2V5cyhkZWZhdWx0Q2hhaW5saW5rT3B0aW9ucykpLFxuKTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBnZXRzIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBjaGFpbmxpbmsuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGlzIGNoYWlubGluaydzIHN0cmluZyB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gY2hhaW5saW5rVG9TdHJpbmcocHJvcGVydGllcykge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIHRva2VucyxcbiAgICAgIHByZWZpeCxcbiAgICAgIHN1ZmZpeCxcbiAgICAgIHNhbml0aXplLFxuICAgICAgc2VwYXJhdG9yLFxuICAgICAgc2FuaXRpemVMaW5rcyxcbiAgICB9ID0gcHJvcGVydGllcztcblxuICAgIGNvbnN0IGV4cGFuZGVkID0gW3ByZWZpeChwcm9wZXJ0aWVzKSwgLi4udG9rZW5zLm1hcChzYW5pdGl6ZUxpbmtzKSwgc3VmZml4KHByb3BlcnRpZXMpXTtcbiAgICByZXR1cm4gc2FuaXRpemUocmVtb3ZlTmlsVmFsdWVzKGV4cGFuZGVkKS5qb2luKHNlcGFyYXRvcihwcm9wZXJ0aWVzKSkpO1xuICB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgY2hhaW5saW5rLlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQ2hhaW5saW5rIGNyZWF0aW9uIG9wdGlvbnMuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBtYWtlQ2hpbGRsaW5rIEEgZnVuY3Rpb24gdG8gY3JlYXRlIGEgY2hpbGRsaW5rcy5cbiAqIEByZXR1cm5zIHtPYmplY3R8ZnVuY3Rpb259IFRoZSBuZXcgY2hhaW5saW5rLlxuICovXG5mdW5jdGlvbiBtYWtlQ2hhaW5saW5rKHsgdG9rZW5zID0gW10sIC4uLm9wdGlvbnMgfSwgbWFrZUNoaWxkbGluaykge1xuICBjb25zdCBjaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzID0gXy5kZWZhdWx0cyhvcHRpb25zLCBkZWZhdWx0Q2hhaW5saW5rT3B0aW9ucyk7XG5cbiAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICBwcm9wZXJ0eTogbnVsbCxcbiAgICAuLi5jaGFpbmxpbmtPcHRpb25zV2l0aERlZmF1bHRzLFxuICAgIC4uLmZ1bmN0aW9uYWxpemVDaGFpbmxpbmtPcHRpb25zKGNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMpLFxuICAgIC8vIEludGVudGlvbmFsOiB0byBwcmV2ZW50IG5vZGUgZnJvbSBib3JraW5nIG91dCB3aGVuIHVzaW5nIGEgZnVuY3Rpb25cbiAgICAvLyBhcyBhIGJhc2UgYW5kIGF0dGVtcHRpbmcgdG8gdXRpbC5pbnNwZWN0IG9yIGNvbnNvbGUubG9nIHRoZSBmdW5jdGlvbi5cbiAgICBpbnNwZWN0OiB1bmRlZmluZWQsXG4gICAgdG9rZW5zLFxuICB9O1xuXG4gIE9iamVjdC5hc3NpZ24ocHJvcGVydGllcywgeyB0b1N0cmluZzogY2hhaW5saW5rVG9TdHJpbmcoeyAuLi5wcm9wZXJ0aWVzIH0pIH0pO1xuXG4gIC8vIFRoZSBcImJhc2VcIiBvZiB0aGUgY2hhaW5saW5rIGNhbiBiZSBlaXRoZXIgYW4gb2JqZWN0IG9yIGZ1bmN0aW9uXG4gIC8vIGlmIGBmdW5jdGlvbmFsQ2hhaW5saW5rc2AgaXMgdHJ1ZSwgY2hhaW5saW5rcyB3aWxsIGJlIGZ1bmN0aW9uc1xuICAvLyBhbmQgd2lsbCBiZSBjYWxsYWJsZSAobGVmdCB1cCB0aGUgdGhlIHVzZXIgdG8gaW1wbGVtZW50KS5cbiAgY29uc3QgYmFzZSA9ICFvcHRpb25zLmludm9jYWJsZUxpbmtzID8ge30gOiBmdW5jdGlvbiBjaGFpbmxpbmsoLi4uYXJncykge1xuICAgIHByb3BlcnRpZXMuaGFuZGxlTGlua0ludm9jYXRpb24oeyAuLi5wcm9wZXJ0aWVzIH0sIC4uLmFyZ3MpO1xuICAgIHJldHVybiBtYWtlQ2hpbGRsaW5rKGJhc2UpO1xuICB9O1xuXG4gIHJldHVybiBPYmplY3QuYXNzaWduKGJhc2UsIHByb3BlcnRpZXMpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgUHJveHkgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gY2hhaW5saW5rLlxuICogQHBhcmFtIHtPYmplY3R8ZnVuY3Rpb259IGNoYWlubGluayBUaGUgY2hhaW5saW5rIHRvIGNyZWF0ZSB0aGUgcHJveHkgZm9yLlxuICogQHBhcmFtIHtmdW5jdGlvbn0gbWFrZUNoaWxkbGluayBBIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGNoaWxkbGluayBpZiB0aGVcbiAqIGRlc2lyZWQgcHJvcGVydHkgZG9lc24ndCBleGlzdCBvbiB0aGUgY3VycmVudCBjaGFpbmxpbmsuXG4gKiBAcmV0dXJuc1xuICogQGV4cG9ydFxuICovXG5mdW5jdGlvbiBwcm94aWZ5Q2hhaW5saW5rKGNoYWlubGluaywgbWFrZUNoaWxkbGluaykge1xuICByZXR1cm4gbmV3IFByb3h5KGNoYWlubGluaywge1xuICAgIC8qKlxuICAgICAqIEEgcHJveHkgdHJhcCB0aGF0IHdpbGwgcmV0dXJuIHRoZSByZXF1ZXN0ZWQgcHJvcGVydHkgaWYgaXQgZXhpc3RzIG9uXG4gICAgICogdGhlIHRhcmdldCdzIHByb3RvdHlwZSwgb3IgcmV0dXJuIGEgXCJjaGlsZCBjaGFpbmxpbmtcIiBpZiBub3QuIEhlcmUsXG4gICAgICogd2UgZG9uJ3QgY2FyZSBhYm91dCBub24tc3RyaW5nIHByb3BlcnRpZXMsIHNpbmNlIHdlIGNhbid0IGhhbmRsZVxuICAgICAqIHRoZW0gYW55d2F5cyAodGhlIHVzZXIgdXNpbmcgeC55Lnogd2lsbCBhbHdheXMgcHJvZHVjZSBhIHN0cmluZykuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgY2hhaW5hYmxlIG9iamVjdCB3aGljaCBpcyBiZWluZyBhY2Nlc3NlZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xTeW1ib2x9IGtleSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgYmVpbmcgYWNjZXNzZWQuXG4gICAgICogQHJldHVybnMge2FueX0gVGhlIGFjdHVhbCB2YWx1ZSBvZiB0YXJnZXRba2V5XSBvciBhIGNoaWxkIGNoYWlubGluay5cbiAgICAgKi9cbiAgICBnZXQodGFyZ2V0LCBrZXkpIHtcbiAgICAgIGlmIChrZXkgaW4gdGFyZ2V0IHx8IGlzTm90U3RyaW5nKGtleSkpIHJldHVybiB0YXJnZXRba2V5XTtcblxuICAgICAgcmV0dXJuIG1ha2VDaGlsZGxpbmsoe1xuICAgICAgICAuLi5jaGFpbmxpbmssXG4gICAgICAgIHByb3BlcnR5OiBrZXksXG4gICAgICAgIHRva2VuczogWy4uLmNoYWlubGluay50b2tlbnMsIGtleV0sXG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgY2hhaW5hYmxlcyBhbmQgdGhlaXIgcHJveHkgb2JqZWN0cy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBUaGUgc2V0dGluZ3MgdXNlZCB0byBjcmVhdGUgdGhlIGNoYWluYWJsZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNoaWxkbGlua0dlbmVyYXRvciBUaGUgbWV0aG9kIHVzZWQgdG8gY3JlYXRlIGNoaWxkcmVuIG9mIHRoaXMgbGluay5cbiAqIFRoaXMgaXMgdXNlZCBieSBgY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzYCB0byBtaXhpbiBkZWZhdWx0IG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7UHJveHl9IFRoZSBjaGFpbmFibGUncyBwcm94eSBvYmplY3QuXG4gKiBAZXhwb3J0XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNoYWluYWJsZUdlbmVyYXRvcihzZXR0aW5ncyA9IHt9KSB7XG4gIGNvbnN0IG9wdGlvbnMgPSBfLmlzU3RyaW5nKHNldHRpbmdzKSA/IHsgcHJlZml4OiBzZXR0aW5ncyB9IDogc2V0dGluZ3M7XG4gIHJldHVybiBwcm94aWZ5Q2hhaW5saW5rKG1ha2VDaGFpbmxpbmsob3B0aW9ucywgY2hhaW5hYmxlR2VuZXJhdG9yKSwgY2hhaW5hYmxlR2VuZXJhdG9yKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGNyZWF0ZSBjaGFpbmFibGUgb2JqZWN0c1xuICogQHBhcmFtIHtPYmplY3R9IGRlZmF1bHRzIFRoZSBkZWZhdWx0IG9wdGlvbnMgZm9yIHRoaXMgY2hhaW5hYmxlIG9iamVjdC5cbiAqIEByZXR1cm5zIHtmdW5jdGlvbn0gQSBmdW5jdGlvbiB0aGF0IHdpbGwgY3JlYXRlIG5ldyBjaGFpbmFibGUgb2JqZWN0cywgd2l0aFxuICogdGhlIHN1cHBsaWVkIGRlZmF1bHRzIG1peGVkIGluIHdpdGggdGhlIG9wdGlvbnMgcHJvdmlkZWQgdG8gdGhlIGZ1bmN0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzKGRlZmF1bHRzID0ge30pIHtcbiAgcmV0dXJuIHNldHRpbmdzID0+IGNoYWluYWJsZUdlbmVyYXRvcihfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgZGVmYXVsdHMpKTtcbn1cbiJdfQ==
