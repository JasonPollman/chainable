'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _pick2 = require('lodash/fp/pick');var _pick3 = _interopRequireDefault(_pick2);var _mapValues2 = require('lodash/fp/mapValues');var _mapValues3 = _interopRequireDefault(_mapValues2);var _compose2 = require('lodash/fp/compose');var _compose3 = _interopRequireDefault(_compose2);var _isNil2 = require('lodash/fp/isNil');var _isNil3 = _interopRequireDefault(_isNil2);var _negate3 = require('lodash/fp/negate');var _negate4 = _interopRequireDefault(_negate3);var _filter2 = require('lodash/fp/filter');var _filter3 = _interopRequireDefault(_filter2);var _defaults2 = require('lodash/defaults');var _defaults3 = _interopRequireDefault(_defaults2);var _keys2 = require('lodash/keys');var _keys3 = _interopRequireDefault(_keys2);var _constant2 = require('lodash/constant');var _constant3 = _interopRequireDefault(_constant2);var _isFunction2 = require('lodash/isFunction');var _isFunction3 = _interopRequireDefault(_isFunction2);var _isString2 = require('lodash/isString');var _isString3 = _interopRequireDefault(_isString2);var _negate5 = require('lodash/negate');var _negate6 = _interopRequireDefault(_negate5);var _noop2 = require('lodash/noop');var _noop3 = _interopRequireDefault(_noop2);var _identity2 = require('lodash/identity');var _identity3 = _interopRequireDefault(_identity2);var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.default =







































































































































chainableGenerator;exports.










chainableGeneratorWithDefaults = chainableGeneratorWithDefaults;function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _objectWithoutProperties(obj, keys) {var target = {};for (var i in obj) {if (keys.indexOf(i) >= 0) continue;if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;target[i] = obj[i];}return target;}function _toConsumableArray(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;} else {return Array.from(arr);}} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * The default options for a new chain link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * These will all be cast as functions so that users
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * can provide functional options if desired.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * @type {Object}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */var defaultChainlinkOptions = { prefix: null, suffix: null, sanitize: _identity3.default, separator: '.', sanitizeLinks: _identity3.default, handleLinkInvocation: _noop3.default }; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The functional negation of _.isString
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var isNotString = (0, _negate6.default)(_isString3.default); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Filters an array by removing all occurrences of `null` and `undefined`.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */var removeNilValues = (0, _filter3.default)((0, _negate4.default)(_isNil3.default)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Converts non-function values to a function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */var maybeCastFunction = function maybeCastFunction(thing) {return (0, _isFunction3.default)(thing) ? thing : (0, _constant3.default)(thing);}; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * Converts all chainlink options to functions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */var functionalizeChainlinkOptions = (0, _compose3.default)((0, _mapValues3.default)(maybeCastFunction), (0, _pick3.default)((0, _keys3.default)(defaultChainlinkOptions))); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Creates a function that gets the string representation of a chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * @returns {string} This chainlink's string value.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */function chainlinkToString(properties) {return function () {var tokens = properties.tokens,prefix = properties.prefix,suffix = properties.suffix,sanitize = properties.sanitize,separator = properties.separator,sanitizeLinks = properties.sanitizeLinks;var expanded = [prefix(properties)].concat(_toConsumableArray(tokens.map(sanitizeLinks)), [suffix(properties)]);return sanitize(removeNilValues(expanded).join(separator(properties)));};} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Creates a new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @param {Object} options Chainlink creation options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @param {function} makeChildlink A function to create a childlinks.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @returns {Object|function} The new chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */function makeChainlink(_ref, makeChildlink) {var _ref$tokens = _ref.tokens,tokens = _ref$tokens === undefined ? [] : _ref$tokens,options = _objectWithoutProperties(_ref, ['tokens']);var chainlinkOptionsWithDefaults = (0, _defaults3.default)(options, defaultChainlinkOptions);var properties = _extends({ property: null }, chainlinkOptionsWithDefaults, functionalizeChainlinkOptions(chainlinkOptionsWithDefaults), { // Intentional: to prevent node from borking out when using a function
    // as a base and attempting to util.inspect or console.log the function.
    inspect: undefined, tokens: tokens });Object.assign(properties, { toString: chainlinkToString(_extends({}, properties)) }); // The "base" of the chainlink can be either an object or function
  // if `functionalChainlinks` is true, chainlinks will be functions
  // and will be callable (left up the the user to implement).
  var base = !options.invocableLinks ? {} : function chainlink() {for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}properties.handleLinkInvocation.apply(properties, [_extends({}, properties)].concat(args));return makeChildlink(base);};return Object.assign(base, properties);} /**
                                                                                                                                                                                                                                                                                                                                                        * Creates a new Proxy object for the given chainlink.
                                                                                                                                                                                                                                                                                                                                                        * @param {Object|function} chainlink The chainlink to create the proxy for.
                                                                                                                                                                                                                                                                                                                                                        * @param {function} makeChildlink A function to create a childlink if the
                                                                                                                                                                                                                                                                                                                                                        * desired property doesn't exist on the current chainlink.
                                                                                                                                                                                                                                                                                                                                                        * @returns
                                                                                                                                                                                                                                                                                                                                                        * @export
                                                                                                                                                                                                                                                                                                                                                        */function proxifyChainlink(chainlink, makeChildlink) {return new Proxy(chainlink, { /**
                                                                                                                                                                                                                                                                                                                                                                                                                                              * A proxy trap that will return the requested property if it exists on
                                                                                                                                                                                                                                                                                                                                                                                                                                              * the target's prototype, or return a "child chainlink" if not. Here,
                                                                                                                                                                                                                                                                                                                                                                                                                                              * we don't care about non-string properties, since we can't handle
                                                                                                                                                                                                                                                                                                                                                                                                                                              * them anyways (the user using x.y.z will always produce a string).
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @param {Object} target The chainable object which is being accessed.
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @param {string|Symbol} key The name of the property being accessed.
                                                                                                                                                                                                                                                                                                                                                                                                                                              * @returns {any} The actual value of target[key] or a child chainlink.
                                                                                                                                                                                                                                                                                                                                                                                                                                              */get: function get(target, key) {if (key in target || isNotString(key)) return target[key];return makeChildlink(_extends({}, chainlink, { property: key, tokens: [].concat(_toConsumableArray(chainlink.tokens), [key]) }));} });} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Generates chainables and their proxy objects.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} settings The settings used to create the chainable.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {function} childlinkGenerator The method used to create children of this link.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * This is used by `chainableGeneratorWithDefaults` to mixin default options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {Proxy} The chainable's proxy object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @export
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function chainableGenerator() {var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};var options = (0, _isString3.default)(settings) ? { prefix: settings } : settings;return proxifyChainlink(makeChainlink(options, chainableGenerator), chainableGenerator);} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Creates a function that will create chainable objects
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @param {Object} defaults The default options for this chainable object.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @returns {function} A function that will create new chainable objects, with
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * the supplied defaults mixed in with the options provided to the function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */function chainableGeneratorWithDefaults() {var defaults = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};return function (settings) {return chainableGenerator((0, _defaults3.default)(settings, defaults));};}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaGFpbmFibGUuanMiXSwibmFtZXMiOlsiY2hhaW5hYmxlR2VuZXJhdG9yIiwiY2hhaW5hYmxlR2VuZXJhdG9yV2l0aERlZmF1bHRzIiwiZGVmYXVsdENoYWlubGlua09wdGlvbnMiLCJwcmVmaXgiLCJzdWZmaXgiLCJzYW5pdGl6ZSIsInNlcGFyYXRvciIsInNhbml0aXplTGlua3MiLCJoYW5kbGVMaW5rSW52b2NhdGlvbiIsImlzTm90U3RyaW5nIiwicmVtb3ZlTmlsVmFsdWVzIiwibWF5YmVDYXN0RnVuY3Rpb24iLCJ0aGluZyIsImZ1bmN0aW9uYWxpemVDaGFpbmxpbmtPcHRpb25zIiwiY2hhaW5saW5rVG9TdHJpbmciLCJwcm9wZXJ0aWVzIiwidG9rZW5zIiwiZXhwYW5kZWQiLCJtYXAiLCJqb2luIiwibWFrZUNoYWlubGluayIsIm1ha2VDaGlsZGxpbmsiLCJvcHRpb25zIiwiY2hhaW5saW5rT3B0aW9uc1dpdGhEZWZhdWx0cyIsInByb3BlcnR5IiwiaW5zcGVjdCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImFzc2lnbiIsInRvU3RyaW5nIiwiYmFzZSIsImludm9jYWJsZUxpbmtzIiwiY2hhaW5saW5rIiwiYXJncyIsInByb3hpZnlDaGFpbmxpbmsiLCJQcm94eSIsImdldCIsInRhcmdldCIsImtleSIsInNldHRpbmdzIiwiZGVmYXVsdHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF3SXdCQSxrQjs7Ozs7Ozs7Ozs7QUFXUkMsOEIsR0FBQUEsOEIsNmVBaEpoQjs7Ozs7K2lCQU1BLElBQU1DLDBCQUEwQixFQUM5QkMsUUFBUSxJQURzQixFQUU5QkMsUUFBUSxJQUZzQixFQUc5QkMsNEJBSDhCLEVBSTlCQyxX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VUFBVSx3QkFBV2lCLFFBQVgsSUFBdUIsRUFBRXBDLFFBQVFvQyxRQUFWLEVBQXZCLEdBQThDQSxRQUE5RCxDQUNBLE9BQU9MLGlCQUFpQmQsY0FBY0UsT0FBZCxFQUF1QnRCLGtCQUF2QixDQUFqQixFQUE2REEsa0JBQTdELENBQVAsQ0FDRCxDLENBRUQ7Ozs7O3k3QkFNTyxTQUFTQyw4QkFBVCxHQUF1RCxLQUFmdUMsUUFBZSx1RUFBSixFQUFJLENBQzVELE9BQU8sNEJBQVl4QyxtQkFBbUIsd0JBQVd1QyxRQUFYLEVBQXFCQyxRQUFyQixDQUFuQixDQUFaLEVBQVAsQ0FDRCIsImZpbGUiOiJjaGFpbmFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGZwIGZyb20gJ2xvZGFzaC9mcCc7XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgYSBuZXcgY2hhaW4gbGluay5cbiAqIFRoZXNlIHdpbGwgYWxsIGJlIGNhc3QgYXMgZnVuY3Rpb25zIHNvIHRoYXQgdXNlcnNcbiAqIGNhbiBwcm92aWRlIGZ1bmN0aW9uYWwgb3B0aW9ucyBpZiBkZXNpcmVkLlxuICogQHR5cGUge09iamVjdH1cbiAqL1xuY29uc3QgZGVmYXVsdENoYWlubGlua09wdGlvbnMgPSB7XG4gIHByZWZpeDogbnVsbCxcbiAgc3VmZml4OiBudWxsLFxuICBzYW5pdGl6ZTogXy5pZGVudGl0eSxcbiAgc2VwYXJhdG9yOiAnLicsXG4gIHNhbml0aXplTGlua3M6IF8uaWRlbnRpdHksXG4gIGhhbmRsZUxpbmtJbnZvY2F0aW9uOiBfLm5vb3AsXG59O1xuXG4vKipcbiAqIFRoZSBmdW5jdGlvbmFsIG5lZ2F0aW9uIG9mIF8uaXNTdHJpbmdcbiAqIEBmdW5jdGlvblxuICovXG5jb25zdCBpc05vdFN0cmluZyA9IF8ubmVnYXRlKF8uaXNTdHJpbmcpO1xuXG4vKipcbiAqIEZpbHRlcnMgYW4gYXJyYXkgYnkgcmVtb3ZpbmcgYWxsIG9jY3VycmVuY2VzIG9mIGBudWxsYCBhbmQgYHVuZGVmaW5lZGAuXG4gKiBAZnVuY3Rpb25cbiAqL1xuY29uc3QgcmVtb3ZlTmlsVmFsdWVzID0gZnAuZmlsdGVyKGZwLm5lZ2F0ZShmcC5pc05pbCkpO1xuXG4vKipcbiAqIENvbnZlcnRzIG5vbi1mdW5jdGlvbiB2YWx1ZXMgdG8gYSBmdW5jdGlvbi5cbiAqIEBmdW5jdGlvblxuICovXG5jb25zdCBtYXliZUNhc3RGdW5jdGlvbiA9IHRoaW5nID0+IChfLmlzRnVuY3Rpb24odGhpbmcpID8gdGhpbmcgOiBfLmNvbnN0YW50KHRoaW5nKSk7XG5cbi8qKlxuICogQ29udmVydHMgYWxsIGNoYWlubGluayBvcHRpb25zIHRvIGZ1bmN0aW9ucy5cbiAqIEBmdW5jdGlvblxuICovXG5jb25zdCBmdW5jdGlvbmFsaXplQ2hhaW5saW5rT3B0aW9ucyA9IGZwLmNvbXBvc2UoXG4gIGZwLm1hcFZhbHVlcyhtYXliZUNhc3RGdW5jdGlvbiksXG4gIGZwLnBpY2soXy5rZXlzKGRlZmF1bHRDaGFpbmxpbmtPcHRpb25zKSksXG4pO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGdldHMgdGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhIGNoYWlubGluay5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoaXMgY2hhaW5saW5rJ3Mgc3RyaW5nIHZhbHVlLlxuICovXG5mdW5jdGlvbiBjaGFpbmxpbmtUb1N0cmluZyhwcm9wZXJ0aWVzKSB7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgdG9rZW5zLFxuICAgICAgcHJlZml4LFxuICAgICAgc3VmZml4LFxuICAgICAgc2FuaXRpemUsXG4gICAgICBzZXBhcmF0b3IsXG4gICAgICBzYW5pdGl6ZUxpbmtzLFxuICAgIH0gPSBwcm9wZXJ0aWVzO1xuXG4gICAgY29uc3QgZXhwYW5kZWQgPSBbcHJlZml4KHByb3BlcnRpZXMpLCAuLi50b2tlbnMubWFwKHNhbml0aXplTGlua3MpLCBzdWZmaXgocHJvcGVydGllcyldO1xuICAgIHJldHVybiBzYW5pdGl6ZShyZW1vdmVOaWxWYWx1ZXMoZXhwYW5kZWQpLmpvaW4oc2VwYXJhdG9yKHByb3BlcnRpZXMpKSk7XG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBjaGFpbmxpbmsuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBDaGFpbmxpbmsgY3JlYXRpb24gb3B0aW9ucy5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IG1ha2VDaGlsZGxpbmsgQSBmdW5jdGlvbiB0byBjcmVhdGUgYSBjaGlsZGxpbmtzLlxuICogQHJldHVybnMge09iamVjdHxmdW5jdGlvbn0gVGhlIG5ldyBjaGFpbmxpbmsuXG4gKi9cbmZ1bmN0aW9uIG1ha2VDaGFpbmxpbmsoeyB0b2tlbnMgPSBbXSwgLi4ub3B0aW9ucyB9LCBtYWtlQ2hpbGRsaW5rKSB7XG4gIGNvbnN0IGNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMgPSBfLmRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRDaGFpbmxpbmtPcHRpb25zKTtcblxuICBjb25zdCBwcm9wZXJ0aWVzID0ge1xuICAgIHByb3BlcnR5OiBudWxsLFxuICAgIC4uLmNoYWlubGlua09wdGlvbnNXaXRoRGVmYXVsdHMsXG4gICAgLi4uZnVuY3Rpb25hbGl6ZUNoYWlubGlua09wdGlvbnMoY2hhaW5saW5rT3B0aW9uc1dpdGhEZWZhdWx0cyksXG4gICAgLy8gSW50ZW50aW9uYWw6IHRvIHByZXZlbnQgbm9kZSBmcm9tIGJvcmtpbmcgb3V0IHdoZW4gdXNpbmcgYSBmdW5jdGlvblxuICAgIC8vIGFzIGEgYmFzZSBhbmQgYXR0ZW1wdGluZyB0byB1dGlsLmluc3BlY3Qgb3IgY29uc29sZS5sb2cgdGhlIGZ1bmN0aW9uLlxuICAgIGluc3BlY3Q6IHVuZGVmaW5lZCxcbiAgICB0b2tlbnMsXG4gIH07XG5cbiAgT2JqZWN0LmFzc2lnbihwcm9wZXJ0aWVzLCB7IHRvU3RyaW5nOiBjaGFpbmxpbmtUb1N0cmluZyh7IC4uLnByb3BlcnRpZXMgfSkgfSk7XG5cbiAgLy8gVGhlIFwiYmFzZVwiIG9mIHRoZSBjaGFpbmxpbmsgY2FuIGJlIGVpdGhlciBhbiBvYmplY3Qgb3IgZnVuY3Rpb25cbiAgLy8gaWYgYGZ1bmN0aW9uYWxDaGFpbmxpbmtzYCBpcyB0cnVlLCBjaGFpbmxpbmtzIHdpbGwgYmUgZnVuY3Rpb25zXG4gIC8vIGFuZCB3aWxsIGJlIGNhbGxhYmxlIChsZWZ0IHVwIHRoZSB0aGUgdXNlciB0byBpbXBsZW1lbnQpLlxuICBjb25zdCBiYXNlID0gIW9wdGlvbnMuaW52b2NhYmxlTGlua3MgPyB7fSA6IGZ1bmN0aW9uIGNoYWlubGluayguLi5hcmdzKSB7XG4gICAgcHJvcGVydGllcy5oYW5kbGVMaW5rSW52b2NhdGlvbih7IC4uLnByb3BlcnRpZXMgfSwgLi4uYXJncyk7XG4gICAgcmV0dXJuIG1ha2VDaGlsZGxpbmsoYmFzZSk7XG4gIH07XG5cbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYmFzZSwgcHJvcGVydGllcyk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBQcm94eSBvYmplY3QgZm9yIHRoZSBnaXZlbiBjaGFpbmxpbmsuXG4gKiBAcGFyYW0ge09iamVjdHxmdW5jdGlvbn0gY2hhaW5saW5rIFRoZSBjaGFpbmxpbmsgdG8gY3JlYXRlIHRoZSBwcm94eSBmb3IuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBtYWtlQ2hpbGRsaW5rIEEgZnVuY3Rpb24gdG8gY3JlYXRlIGEgY2hpbGRsaW5rIGlmIHRoZVxuICogZGVzaXJlZCBwcm9wZXJ0eSBkb2Vzbid0IGV4aXN0IG9uIHRoZSBjdXJyZW50IGNoYWlubGluay5cbiAqIEByZXR1cm5zXG4gKiBAZXhwb3J0XG4gKi9cbmZ1bmN0aW9uIHByb3hpZnlDaGFpbmxpbmsoY2hhaW5saW5rLCBtYWtlQ2hpbGRsaW5rKSB7XG4gIHJldHVybiBuZXcgUHJveHkoY2hhaW5saW5rLCB7XG4gICAgLyoqXG4gICAgICogQSBwcm94eSB0cmFwIHRoYXQgd2lsbCByZXR1cm4gdGhlIHJlcXVlc3RlZCBwcm9wZXJ0eSBpZiBpdCBleGlzdHMgb25cbiAgICAgKiB0aGUgdGFyZ2V0J3MgcHJvdG90eXBlLCBvciByZXR1cm4gYSBcImNoaWxkIGNoYWlubGlua1wiIGlmIG5vdC4gSGVyZSxcbiAgICAgKiB3ZSBkb24ndCBjYXJlIGFib3V0IG5vbi1zdHJpbmcgcHJvcGVydGllcywgc2luY2Ugd2UgY2FuJ3QgaGFuZGxlXG4gICAgICogdGhlbSBhbnl3YXlzICh0aGUgdXNlciB1c2luZyB4LnkueiB3aWxsIGFsd2F5cyBwcm9kdWNlIGEgc3RyaW5nKS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBjaGFpbmFibGUgb2JqZWN0IHdoaWNoIGlzIGJlaW5nIGFjY2Vzc2VkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfFN5bWJvbH0ga2V5IFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSBiZWluZyBhY2Nlc3NlZC5cbiAgICAgKiBAcmV0dXJucyB7YW55fSBUaGUgYWN0dWFsIHZhbHVlIG9mIHRhcmdldFtrZXldIG9yIGEgY2hpbGQgY2hhaW5saW5rLlxuICAgICAqL1xuICAgIGdldCh0YXJnZXQsIGtleSkge1xuICAgICAgaWYgKGtleSBpbiB0YXJnZXQgfHwgaXNOb3RTdHJpbmcoa2V5KSkgcmV0dXJuIHRhcmdldFtrZXldO1xuXG4gICAgICByZXR1cm4gbWFrZUNoaWxkbGluayh7XG4gICAgICAgIC4uLmNoYWlubGluayxcbiAgICAgICAgcHJvcGVydHk6IGtleSxcbiAgICAgICAgdG9rZW5zOiBbLi4uY2hhaW5saW5rLnRva2Vucywga2V5XSxcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlcyBjaGFpbmFibGVzIGFuZCB0aGVpciBwcm94eSBvYmplY3RzLlxuICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFRoZSBzZXR0aW5ncyB1c2VkIHRvIGNyZWF0ZSB0aGUgY2hhaW5hYmxlLlxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2hpbGRsaW5rR2VuZXJhdG9yIFRoZSBtZXRob2QgdXNlZCB0byBjcmVhdGUgY2hpbGRyZW4gb2YgdGhpcyBsaW5rLlxuICogVGhpcyBpcyB1c2VkIGJ5IGBjaGFpbmFibGVHZW5lcmF0b3JXaXRoRGVmYXVsdHNgIHRvIG1peGluIGRlZmF1bHQgb3B0aW9ucy5cbiAqIEByZXR1cm5zIHtQcm94eX0gVGhlIGNoYWluYWJsZSdzIHByb3h5IG9iamVjdC5cbiAqIEBleHBvcnRcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY2hhaW5hYmxlR2VuZXJhdG9yKHNldHRpbmdzID0ge30pIHtcbiAgY29uc3Qgb3B0aW9ucyA9IF8uaXNTdHJpbmcoc2V0dGluZ3MpID8geyBwcmVmaXg6IHNldHRpbmdzIH0gOiBzZXR0aW5ncztcbiAgcmV0dXJuIHByb3hpZnlDaGFpbmxpbmsobWFrZUNoYWlubGluayhvcHRpb25zLCBjaGFpbmFibGVHZW5lcmF0b3IpLCBjaGFpbmFibGVHZW5lcmF0b3IpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgY3JlYXRlIGNoYWluYWJsZSBvYmplY3RzXG4gKiBAcGFyYW0ge09iamVjdH0gZGVmYXVsdHMgVGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgdGhpcyBjaGFpbmFibGUgb2JqZWN0LlxuICogQHJldHVybnMge2Z1bmN0aW9ufSBBIGZ1bmN0aW9uIHRoYXQgd2lsbCBjcmVhdGUgbmV3IGNoYWluYWJsZSBvYmplY3RzLCB3aXRoXG4gKiB0aGUgc3VwcGxpZWQgZGVmYXVsdHMgbWl4ZWQgaW4gd2l0aCB0aGUgb3B0aW9ucyBwcm92aWRlZCB0byB0aGUgZnVuY3Rpb24uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGFpbmFibGVHZW5lcmF0b3JXaXRoRGVmYXVsdHMoZGVmYXVsdHMgPSB7fSkge1xuICByZXR1cm4gc2V0dGluZ3MgPT4gY2hhaW5hYmxlR2VuZXJhdG9yKF8uZGVmYXVsdHMoc2V0dGluZ3MsIGRlZmF1bHRzKSk7XG59XG4iXX0=
